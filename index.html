<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>C√¥ng c·ª• T√≠nh ƒëi·ªÉm x√©t h·ªçc b·∫° - APAG</title>
  <style>
    :root {
      --apag-red: #E03A3E;
      --apag-blue-dark: #1A2D6C;
      --apag-blue-light: #0984e3;
      --apag-highlight: #ffeaa7;
    }

    body {
      font-family: "Segoe UI", sans-serif;
      padding: 20px;
      background: linear-gradient(to bottom right, #f9fafb, #fdfdfd);
    }
    body::before {
      content: '';
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 120px;
      height: 120px;
      background-image: url('https://i.imgur.com/ZVh0PBP.png'); /* Thay b·∫±ng logo APAG n·∫øu c√≥ */
      background-size: contain;
      background-repeat: no-repeat;
      opacity: 0.07;
      z-index: 0;
      pointer-events: none;
    }
    .header {
      background: linear-gradient(to right, #1A2D6C, #E03A3E);
      color: white;
      border: none;
      border-radius: 4px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .header-logo {
      text-align: center;
      margin-bottom: 10px;
    }
    .header-logo img {
      max-height: 60px;
    }
    .header h2,
    .header p,
    .header a {
      color: white;
    }
    .container {
      display: flex;
      gap: 20px;
    }
    .left {
      flex: 1;
      max-width: 33%;
      background-color: #ffffff;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    }

    .right {
      flex: 2;
      background-color: #ffffff;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
      font-size: 14px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    th {
  background-color: var(--apag-blue-light);
  color: #fff;
  font-weight: bold;
    }
    h3 {
  color: var(--apag-blue-dark);
  margin-bottom: 10px;
    }
.form-group {
  display: flex;
  align-items: center;
  margin-bottom: 12px;
}
.form-group label {
  width: 160px;
  font-weight: bold;
}
.form-group input, .form-group select {
  flex: 1;
  padding: 6px;
  border-radius: 4px;
  border: 1px solid #ccc;
}
    .highlight {
      background-color: var(--apag-highlight);
      font-weight: bold;
    }
    #topResult {
      font-weight: bold;
      color: var(--apag-blue-light);
      margin-top: 10px;
      font-size: 16px;
    }
    #canhbao {
      background-color: #fff3cd;
      color: #856404;
      border-left: 4px solid var(--apag-red);
      border: 1px solid #ffeeba;
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 4px;
      font-size: 14px;
    }
    .canhbao-item {
      margin-bottom: 5px;
      display: flex;
      align-items: center;
    }
    .canhbao-item i {
      margin-right: 6px;
      color: #e67e22;
    }
    input[type="submit"], button {
      background-color: var(--apag-blue-dark);
      color: #fff;
      border: none;
      padding: 10px 20px;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.2s;
    }
    input[type="submit"]:hover, button:hover {
      background-color: var(--apag-blue-light);
    }
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input[type="number"] {
      -moz-appearance: textfield;
    }
  </style>
</head>
<body>
  <div class="header">
    <h2>üéì C√¥ng c·ª• T√≠nh ƒëi·ªÉm x√©t h·ªçc b·∫° THPT</h2>
    <p><strong>H·ªåC VI·ªÜN H√ÄNH CH√çNH V√Ä QU·∫¢N TR·ªä C√îNG (APAG)</strong></p>
    <p>üìû Hotline: 1900.099.996 | üåê Website: <a href="https://apag.edu.vn" target="_blank">apag.edu.vn</a></p>
    <p>üîπ Facebook: <a href="https://fb.com/tuyensinhapag" target="_blank">fb.com/tuyensinhapag</a> üéµ TikTok: @tuyensinhapag | üì∏ Instagram: @tuyensinhapag</p>
  </div>
  <div class="container">
    <div class="left">
      <form id="scoreForm">
        <h3>Nh·∫≠p ƒëi·ªÉm c√°c m√¥n</h3>
        <div id="canhbao" style="display:none;"></div>
        <label>H·ªç v√† t√™n th√≠ sinh: <input name="hoten" id="hoten" required></label><br><br>
        <label>Ng√†nh/Chuy√™n ng√†nh ƒëƒÉng k√Ω:
          <select name="manganh" id="manganh" required>
            <option value="" disabled selected>-- Ch·ªçn ng√†nh/chuy√™n ng√†nh --</option>
             <!-- H√† N·ªôi -->
             <option value="" disabled selected>-- T·∫°i H√† N·ªôi --</option>
            <option value="7340404-H√† N·ªôi">Ng√†nh Qu·∫£n tr·ªã nh√¢n l·ª±c t·∫°i H√† N·ªôi</option>
            <option value="7340406-H√† N·ªôi">Ng√†nh Qu·∫£n tr·ªã vƒÉn ph√≤ng v√† chuy√™n ng√†nh t·∫°i H√† N·ªôi</option>
            <option value="7380101-H√† N·ªôi">Ng√†nh Lu·∫≠t v√† chuy√™n ng√†nh t·∫°i H√† N·ªôi</option>
            <option value="7310101-H√† N·ªôi">Ng√†nh Kinh t·∫ø v√† chuy√™n ng√†nh t·∫°i H√† N·ªôi</option>
            <option value="7310205-H√† N·ªôi">Ng√†nh Qu·∫£n l√Ω nh√† n∆∞·ªõc t·∫°i H√† N·ªôi</option>
            <option value="7310201-H√† N·ªôi">Ng√†nh Ch√≠nh tr·ªã h·ªçc v√† chuy√™n ng√†nh t·∫°i H√† N·ªôi</option>
            <option value="7310202-H√† N·ªôi">Ng√†nh X√¢y d·ª±ng ƒê·∫£ng v√† ch√≠nh quy·ªÅn nh√† n∆∞·ªõc t·∫°i H√† N·ªôi</option>
            <option value="7320303-H√† N·ªôi">Ng√†nh L∆∞u tr·ªØ h·ªçc v√† chuy√™n ng√†nh t·∫°i H√† N·ªôi</option>
            <option value="7320201-H√† N·ªôi">Ng√†nh Th√¥ng tin ‚Äì th∆∞ vi·ªán v√† chuy√™n ng√†nh t·∫°i H√† N·ªôi</option>
            <option value="7810103-H√† N·ªôi">Ng√†nh Qu·∫£n tr·ªã d·ªãch v·ª• du l·ªãch v√† l·ªØ h√†nh t·∫°i H√† N·ªôi</option>
            <option value="7229042-H√† N·ªôi">Ng√†nh Qu·∫£n l√Ω vƒÉn h√≥a v√† chuy√™n ng√†nh t·∫°i H√† N·ªôi</option>
            <option value="7229040-01-H√† N·ªôi">Chuy√™n ng√†nh VƒÉn h√≥a Du l·ªãch t·∫°i H√† N·ªôi</option>
            <option value="7229040-02-H√† N·ªôi">Chuy√™n ng√†nh VƒÉn h√≥a Truy·ªÅn th√¥ng t·∫°i H√† N·ªôi</option>
            <option value="7220201-H√† N·ªôi">Ng√†nh Ng√¥n ng·ªØ Anh t·∫°i H√† N·ªôi</option>
            <option value="7480104-H√† N·ªôi">Ng√†nh H·ªá th·ªëng th√¥ng tin v√† chuy√™n ng√†nh t·∫°i H√† N·ªôi</option>

            <!-- Qu·∫£ng Nam -->
            <option value="" disabled selected>-- T·∫°i Qu·∫£ng Nam --</option>
            <option value="7340404-Qu·∫£ng Nam">Ng√†nh Qu·∫£n tr·ªã nh√¢n l·ª±c t·∫°i Qu·∫£ng Nam</option>
            <option value="7340406-Qu·∫£ng Nam">Ng√†nh Qu·∫£n tr·ªã vƒÉn ph√≤ng t·∫°i Qu·∫£ng Nam</option>
            <option value="7380101-Qu·∫£ng Nam">Ng√†nh Lu·∫≠t v√† chuy√™n ng√†nh t·∫°i Qu·∫£ng Nam</option>
            <option value="7310205-Qu·∫£ng Nam">Ng√†nh Qu·∫£n l√Ω nh√† n∆∞·ªõc t·∫°i Qu·∫£ng Nam</option>
            <option value="7810103-Qu·∫£ng Nam">Ng√†nh Qu·∫£n tr·ªã d·ªãch v·ª• du l·ªãch v√† l·ªØ h√†nh t·∫°i Qu·∫£ng Nam</option>
            <option value="7310101-Qu·∫£ng Nam">Ng√†nh Kinh t·∫ø t·∫°i Qu·∫£ng Nam</option>

            <!-- TP. HCM -->
            <option value="" disabled selected>-- T·∫°i TP. H·ªì Ch√≠ Minh --</option>
            <option value="7380101-TP-HCM">Ng√†nh Lu·∫≠t v√† chuy√™n ng√†nh t·∫°i TP. HCM</option>
            <option value="7340404-TP-HCM">Ng√†nh Qu·∫£n tr·ªã nh√¢n l·ª±c t·∫°i TP. HCM</option>
            <option value="7340406-TP-HCM">Ng√†nh Qu·∫£n tr·ªã vƒÉn ph√≤ng t·∫°i TP. HCM</option>
            <option value="7310205-TP-HCM">Ng√†nh Qu·∫£n l√Ω nh√† n∆∞·ªõc t·∫°i TP. HCM</option>
            <option value="7310202-TP-HCM">Ng√†nh X√¢y d·ª±ng ƒê·∫£ng v√† ch√≠nh quy·ªÅn nh√† n∆∞·ªõc t·∫°i TP. HCM</option>
            <option value="7320303-TP-HCM">Ng√†nh L∆∞u tr·ªØ h·ªçc v√† chuy√™n ng√†nh t·∫°i TP. HCM</option>
            <option value="7310101-TP-HCM">Ng√†nh Kinh t·∫ø t·∫°i TP. HCM</option>

            <!-- ƒê·∫Øk L·∫Øk -->
            <option value="" disabled selected>-- T·∫°i ƒê·∫Øk L·∫Øk --</option>
            <option value="7310205-ƒê·∫Øk L·∫Øk">Ng√†nh Qu·∫£n l√Ω nh√† n∆∞·ªõc t·∫°i ƒê·∫Øk L·∫Øk</option>
            <option value="7340404-ƒê·∫Øk L·∫Øk">Ng√†nh Qu·∫£n tr·ªã nh√¢n l·ª±c t·∫°i ƒê·∫Øk L·∫Øk</option>
            <option value="7380101-ƒê·∫Øk L·∫Øk">Ng√†nh Lu·∫≠t t·∫°i ƒê·∫Øk L·∫Øk</option>
          </select>
        </label>
        <div id="topResult"></div>
        <table id="scoreTable">
          <tr>
            <th>M√¥n</th>
            <th>Trung b√¨nh L·ªõp 10</th>
            <th>Trung b√¨nh L·ªõp 11</th>
            <th>Trung b√¨nh L·ªõp 12</th>
            <th>TBM</th>
          </tr>
        </table>
        <br>
        <input type="submit" value="T√≠nh ƒëi·ªÉm">
        <button type="button" onclick="clearForm()">X√≥a d·ªØ li·ªáu</button>
      </form>
    </div>

    <div class="right">
      <h3>K·∫øt qu·∫£ t·ªï h·ª£p</h3>
      <div id="result"></div>
    </div>
  </div>

  <script>
    const subjects = ["toan", "ly", "hoa", "van", "su", "dia", "anh", "tin", "gdk"];

window.onload = function () {
  // √âp dropdown ng√†nh v·ªÅ m·∫∑c ƒë·ªãnh m·ªói khi load trang
  document.getElementById("manganh").selectedIndex = 0;

  const table = document.getElementById("scoreTable");
  subjects.forEach(mon => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${mon.toUpperCase()}</td>
      <td><input name="${mon}10" type="number" min="0" max="10" step="0.01" style="text-align: center;" oninput="toggleNext(this, '${mon}')"></td>
      <td><input name="${mon}11" type="number" min="0" max="10" step="0.01" style="text-align: center;" disabled oninput="updateAverage('${mon}')"></td>
      <td><input name="${mon}12" type="number" min="0" max="10" step="0.01" style="text-align: center;" disabled oninput="updateAverage('${mon}')"></td>
      <td id="${mon}avg" style="text-align: center; font-weight: bold;">‚Äî</td>
    `;
    table.appendChild(row);
  });
};


    function toggleNext(el, mon) {
      const val = el.value.trim();
      const disable = (val === "");
      const el11 = document.querySelector(`input[name="${mon}11"]`);
      const el12 = document.querySelector(`input[name="${mon}12"]`);
      el11.disabled = disable;
      el12.disabled = disable;
      updateAverage(mon);
    }

function updateAverage(mon) {
  const d10El = document.querySelector(`input[name="${mon}10"]`);
  const d11El = document.querySelector(`input[name="${mon}11"]`);
  const d12El = document.querySelector(`input[name="${mon}12"]`);

  const d10 = parseFloat(d10El.value);
  const d11 = parseFloat(d11El.value);
  const d12 = parseFloat(d12El.value);
  const avgCell = document.getElementById(`${mon}avg`);

  const inputs = [
    { el: d10El, val: d10, label: "L·ªõp 10" },
    { el: d11El, val: d11, label: "L·ªõp 11" },
    { el: d12El, val: d12, label: "L·ªõp 12" }
  ];

  // Ki·ªÉm tra n·∫øu ƒë√£ nh·∫≠p th√¨ kh√¥ng ƒë∆∞·ª£c < 1
  inputs.forEach(({ el, val, label }) => {
    if (!isNaN(val) && val < 1) {
      el.style.border = "2px solid red";
      el.title = `‚ö†Ô∏è ƒêi·ªÉm ${mon.toUpperCase()} ${label} qu√° th·∫•p (d∆∞·ªõi 1 ƒëi·ªÉm)!`;
    } else {
      el.style.border = "";
      el.title = "";
    }
  });

  if (!isNaN(d10) && !isNaN(d11) && !isNaN(d12)) {
    const avg = ((d10 + d11 + d12) / 3).toFixed(2);
    avgCell.textContent = avg;

    if (avg > 10) {
      avgCell.style.color = "red";
      avgCell.title = "‚ö†Ô∏è TBM kh√¥ng th·ªÉ l·ªõn h∆°n 10!";
    } else {
      avgCell.style.color = "";
      avgCell.title = "";
    }
  } else {
    avgCell.textContent = "‚Äî";
    avgCell.style.color = "";
    avgCell.title = "";
  }
}



    function clearForm() {
      document.getElementById("scoreForm").reset();
      subjects.forEach(mon => {
        document.querySelector(`input[name="${mon}11"]`).disabled = true;
        document.querySelector(`input[name="${mon}12"]`).disabled = true;
        document.getElementById(`${mon}avg`).textContent = "‚Äî";
      });
      document.getElementById("result").innerHTML = "";
      document.getElementById("topResult").innerText = "";
      document.getElementById("manganh").selectedIndex = 0;
      document.getElementById("canhbao").style.display = "none";
      document.getElementById("canhbao").innerHTML = "";
    }

    document.getElementById("scoreForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const form = new FormData(e.target);
      const data = Object.fromEntries(form.entries());
      const warnings = [];

      for (let mon of subjects) {
        const d10 = form.get(`${mon}10`);
        const d11 = form.get(`${mon}11`);
        const d12 = form.get(`${mon}12`);
        if (d10 && (!d11 || !d12)) {
          warnings.push(`<div class='canhbao-item'><i>‚ö†Ô∏è</i> M√¥n ${mon.toUpperCase()}: ƒê√£ nh·∫≠p l·ªõp 10 nh∆∞ng ch∆∞a nh·∫≠p l·ªõp 11 ho·∫∑c 12.</div>`);
        }
      }

      const canhbao = document.getElementById("canhbao");
      if (warnings.length > 0) {
        canhbao.innerHTML = warnings.join("");
        canhbao.style.display = "block";
        canhbao.scrollIntoView({ behavior: 'smooth' });
        return;
      } else {
        canhbao.innerHTML = "";
        canhbao.style.display = "none";
      }

      google.script.run.withSuccessHandler(function(res) {
        document.getElementById("result").innerHTML = res.html;
        document.getElementById("topResult").innerText = `üèÜ T·ªï h·ª£p cao nh·∫•t: ${res.top} ‚Äì ${res.score} ƒëi·ªÉm`;
      }).tinhTatCaToHop(data);
    });
  </script>
  <div style="text-align: center; font-size: 13px; color: #666; margin-top: 40px;">
  Thi·∫øt k·∫ø b·ªüi <strong>Nguy·ªÖn Anh Quy·ªÅn</strong> ‚Äì Chuy√™n vi√™n Ban Qu·∫£n l√Ω ƒë√†o t·∫°o
</div>

</body>
</html>
